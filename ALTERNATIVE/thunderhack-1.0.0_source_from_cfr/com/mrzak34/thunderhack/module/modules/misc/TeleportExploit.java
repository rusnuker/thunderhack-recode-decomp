/*
 * Decompiled with CFR 0.150.
 * 
 * Could not load the following classes:
 *  com.google.common.collect.Lists
 *  com.google.common.eventbus.Subscribe
 *  com.mojang.blaze3d.systems.RenderSystem
 *  net.minecraft.class_1268
 *  net.minecraft.class_1297
 *  net.minecraft.class_1495
 *  net.minecraft.class_243
 *  net.minecraft.class_2596
 *  net.minecraft.class_2724
 *  net.minecraft.class_2824
 *  net.minecraft.class_287
 *  net.minecraft.class_289
 *  net.minecraft.class_327
 *  net.minecraft.class_332
 *  net.minecraft.class_4184
 *  net.minecraft.class_4587
 *  net.minecraft.class_4597
 *  net.minecraft.class_4597$class_4598
 *  net.minecraft.class_7833
 */
package com.mrzak34.thunderhack.module.modules.misc;

import com.google.common.collect.Lists;
import com.google.common.eventbus.Subscribe;
import com.mojang.blaze3d.systems.RenderSystem;
import com.mrzak34.thunderhack.event.events.PacketEvent;
import com.mrzak34.thunderhack.event.events.RenderWorldEvent;
import com.mrzak34.thunderhack.module.Category;
import com.mrzak34.thunderhack.module.Module;
import com.mrzak34.thunderhack.settings.ModeSetting;
import com.mrzak34.thunderhack.util.RenderUtil;
import java.util.ArrayList;
import net.minecraft.class_1268;
import net.minecraft.class_1297;
import net.minecraft.class_1495;
import net.minecraft.class_243;
import net.minecraft.class_2596;
import net.minecraft.class_2724;
import net.minecraft.class_2824;
import net.minecraft.class_287;
import net.minecraft.class_289;
import net.minecraft.class_327;
import net.minecraft.class_332;
import net.minecraft.class_4184;
import net.minecraft.class_4587;
import net.minecraft.class_4597;
import net.minecraft.class_7833;

public class TeleportExploit
extends Module {
    ModeSetting mode = new ModeSetting("mode", "teleport", "teleport", "dupe", "test");
    class_243 teleportPos;
    public static int donkeyID = 0;

    public TeleportExploit() {
        super("TeleportExploit", 0, false, Category.MISC);
        this.addSettings(this.mode);
    }

    @Subscribe
    public void onRenderWorld(RenderWorldEvent event) {
        if (TeleportExploit.mc.field_1687.method_8469(donkeyID) != null) {
            class_243 pos = RenderUtil.smoothMovement(TeleportExploit.mc.field_1687.method_8469(donkeyID)).method_1031(0.0, (double)TeleportExploit.mc.field_1687.method_8469(donkeyID).method_17682() + 0.25, 0.0);
            this.renderNameTag((class_1495)TeleportExploit.mc.field_1687.method_8469(donkeyID), pos);
        }
    }

    @Subscribe
    public void onPacketReceive(PacketEvent.Receive event) {
        if (event.getPacket() instanceof class_2724 && this.mode.getMode().equals("dupe") && donkeyID != 0) {
            TeleportExploit.mc.field_1724.method_5873(TeleportExploit.mc.field_1687.method_8469(donkeyID), true);
            TeleportExploit.mc.field_1724.field_3944.method_2883((class_2596)class_2824.method_34207((class_1297)TeleportExploit.mc.field_1687.method_8469(donkeyID), (boolean)TeleportExploit.mc.field_1724.method_5715(), (class_1268)class_1268.field_5808));
            donkeyID = 0;
            this.setToggled(false);
        }
        if (event.getPacket() instanceof class_2724) {
            class_2724 packet = (class_2724)event.getPacket();
            if (this.mode.getMode().equals("test")) {
                event.setCancelled(true);
            }
        }
    }

    private void renderNameTag(class_1495 donkey, class_243 pos) {
        class_327 tr = TeleportExploit.mc.field_1772;
        String displayTag = "donkey";
        int width = tr.method_1727(displayTag) / 2;
        class_4184 camera = TeleportExploit.mc.field_1773.method_19418();
        double distance = TeleportExploit.mc.field_1724.method_5739((class_1297)donkey);
        double scale = distance * 10.0 / 100.0;
        if (distance <= 8.0) {
            scale = 1.0;
        }
        class_4587 matrices = RenderUtil.matrixFrom(pos);
        matrices.method_22907(class_7833.field_40716.rotationDegrees(-camera.method_19330()));
        matrices.method_22907(class_7833.field_40714.rotationDegrees(camera.method_19329()));
        RenderSystem.enableBlend();
        RenderSystem.defaultBlendFunc();
        matrices.method_22904(0.0, 0.0, 0.0);
        matrices.method_22905(-0.025f * (float)scale, -0.025f * (float)scale, 1.0f);
        class_4597.class_4598 immediate = class_4597.method_22991((class_287)class_289.method_1348().method_1349());
        class_332.method_25303((class_4587)matrices, (class_327)TeleportExploit.mc.field_1772, (String)displayTag, (int)(-(width / 2)), (int)0, (int)-1);
    }

    @Override
    public void onTick() {
        super.onTick();
        try {
            donkeyID = TeleportExploit.getDonkey(4.2).method_5628();
        }
        catch (Exception exception) {
            // empty catch block
        }
    }

    @Override
    public void onDisable() {
        super.onDisable();
        if (donkeyID != 0) {
            TeleportExploit.mc.field_1724.method_5873(TeleportExploit.mc.field_1687.method_8469(donkeyID), true);
            TeleportExploit.mc.field_1724.field_3944.method_2883((class_2596)class_2824.method_34207((class_1297)TeleportExploit.mc.field_1687.method_8469(donkeyID), (boolean)TeleportExploit.mc.field_1724.method_5715(), (class_1268)class_1268.field_5808));
        }
        donkeyID = 0;
    }

    public static class_1495 getDonkey(double range) {
        ArrayList donkeys = Lists.newArrayList();
        for (class_1297 entity : TeleportExploit.mc.field_1687.method_18112()) {
            if (!(entity instanceof class_1495)) continue;
            donkeys.add((class_1495)entity);
        }
        return donkeys.size() == 0 ? null : (class_1495)donkeys.stream().filter(donkey -> (double)TeleportExploit.mc.field_1724.method_5739((class_1297)donkey) <= range).findFirst().orElse(null);
    }

    @Override
    public void onEnable() {
        super.onEnable();
        this.teleportPos = TeleportExploit.mc.field_1724.method_19538();
    }
}

