//Deobfuscated with https://github.com/SimplyProgrammer/Minecraft-Deobfuscator3000 using mappings "E:\cocaine"!

//Decompiled by Procyon!

package com.mrzak34.thunderhack.module.modules.misc;

import com.mrzak34.thunderhack.module.*;
import com.mrzak34.thunderhack.settings.*;
import com.mrzak34.thunderhack.util.*;
import com.google.common.eventbus.*;
import com.mrzak34.thunderhack.event.events.*;
import com.mojang.blaze3d.systems.*;
import net.minecraft.*;
import com.google.common.collect.*;
import java.util.*;

public class TeleportExploit extends Module
{
    ModeSetting mode;
    class_243 teleportPos;
    public static int donkeyID;
    
    public TeleportExploit() {
        super("TeleportExploit", 0, false, Category.MISC);
        this.mode = new ModeSetting("mode", "teleport", new String[] { "teleport", "dupe", "test" });
        this.addSettings(new Setting[] { this.mode });
    }
    
    @Subscribe
    public void onRenderWorld(final RenderWorldEvent event) {
        if (TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID) != null) {
            final class_243 pos = RenderUtil.smoothMovement(TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID)).method_1031(0.0, TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID).method_17682() + 0.25, 0.0);
            this.renderNameTag((class_1495)TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID), pos);
        }
    }
    
    @Subscribe
    public void onPacketReceive(final PacketEvent.Receive event) {
        if (event.getPacket() instanceof class_2724 && this.mode.getMode().equals("dupe") && TeleportExploit.donkeyID != 0) {
            TeleportExploit.mc.field_1724.method_5873(TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID), true);
            TeleportExploit.mc.field_1724.field_3944.method_2883((class_2596)class_2824.method_34207(TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID), TeleportExploit.mc.field_1724.method_5715(), class_1268.field_5808));
            TeleportExploit.donkeyID = 0;
            this.setToggled(false);
        }
        if (event.getPacket() instanceof class_2724) {
            final class_2724 packet = (class_2724)event.getPacket();
            if (this.mode.getMode().equals("test")) {
                event.setCancelled(true);
            }
        }
    }
    
    private void renderNameTag(final class_1495 donkey, final class_243 pos) {
        final class_327 tr = TeleportExploit.mc.field_1772;
        final String displayTag = "donkey";
        final int width = tr.method_1727(displayTag) / 2;
        final class_4184 camera = TeleportExploit.mc.field_1773.method_19418();
        final double distance = TeleportExploit.mc.field_1724.method_5739((class_1297)donkey);
        double scale = distance * 10.0 / 100.0;
        if (distance <= 8.0) {
            scale = 1.0;
        }
        final class_4587 matrices = RenderUtil.matrixFrom(pos);
        matrices.method_22907(class_7833.field_40716.rotationDegrees(-camera.method_19330()));
        matrices.method_22907(class_7833.field_40714.rotationDegrees(camera.method_19329()));
        RenderSystem.enableBlend();
        RenderSystem.defaultBlendFunc();
        matrices.method_22904(0.0, 0.0, 0.0);
        matrices.method_22905(-0.025f * (float)scale, -0.025f * (float)scale, 1.0f);
        final class_4597.class_4598 immediate = class_4597.method_22991(class_289.method_1348().method_1349());
        class_332.method_25303(matrices, TeleportExploit.mc.field_1772, displayTag, -(width / 2), 0, -1);
    }
    
    public void onTick() {
        super.onTick();
        try {
            TeleportExploit.donkeyID = getDonkey(4.2).method_5628();
        }
        catch (Exception ex) {}
    }
    
    public void onDisable() {
        super.onDisable();
        if (TeleportExploit.donkeyID != 0) {
            TeleportExploit.mc.field_1724.method_5873(TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID), true);
            TeleportExploit.mc.field_1724.field_3944.method_2883((class_2596)class_2824.method_34207(TeleportExploit.mc.field_1687.method_8469(TeleportExploit.donkeyID), TeleportExploit.mc.field_1724.method_5715(), class_1268.field_5808));
        }
        TeleportExploit.donkeyID = 0;
    }
    
    public static class_1495 getDonkey(final double range) {
        final List<class_1495> donkeys = (List<class_1495>)Lists.newArrayList();
        for (final class_1297 entity : TeleportExploit.mc.field_1687.method_18112()) {
            if (entity instanceof class_1495) {
                donkeys.add((class_1495)entity);
            }
        }
        return (donkeys.size() == 0) ? null : donkeys.stream().filter(donkey -> TeleportExploit.mc.field_1724.method_5739(donkey) <= range).findFirst().orElse(null);
    }
    
    public void onEnable() {
        super.onEnable();
        this.teleportPos = TeleportExploit.mc.field_1724.method_19538();
    }
    
    static {
        TeleportExploit.donkeyID = 0;
    }
}
